# 3D Visualizations

3D visualizations add depth to your data analysis, revealing patterns and relationships that might be hidden in 2D views. Visivo supports various 3D chart types for scientific, engineering, and business applications.

## When to Use 3D Charts

- **Multi-dimensional Analysis**: Visualize relationships between 3+ variables
- **Spatial Data**: Display geographic or volumetric information
- **Surface Analysis**: Show continuous functions or interpolated data
- **Scientific Visualization**: Present complex mathematical or physical phenomena

## 3D Scatter Plot

Visualize three-dimensional relationships:

```yaml
name: 3d-analysis

sources:
  - name: analysis_db
    type: duckdb
    database: ":memory:"

models:
  - name: customer_segments
    source_name: analysis_db
    sql: |
      WITH customers AS (
        SELECT 
          'Segment ' || (s % 3 + 1) as segment,
          20 + (RANDOM() * 60) as age,
          10000 + (RANDOM() * 90000) as income,
          1 + (RANDOM() * 9) as satisfaction_score,
          CASE 
            WHEN s % 3 = 0 THEN '#3498db'
            WHEN s % 3 = 1 THEN '#e74c3c'
            ELSE '#2ecc71'
          END as color
        FROM generate_series(1, 150) as s
      )
      SELECT * FROM customers

traces:
  - name: customer_scatter_3d
    model: ${ref(customer_segments)}
    props:
      type: scatter3d
      x: ?{age}
      y: ?{income}
      z: ?{satisfaction_score}
      mode: "markers"
      marker:
        size: 8
        color: ?{color}
        opacity: 0.8
        line:
          color: "white"
          width: 0.5
      text: ?{segment}
      hovertemplate: |
        <b>%{text}</b><br>
        Age: %{x}<br>
        Income: $%{y:,.0f}<br>
        Satisfaction: %{z:.1f}<br>
        <extra></extra>
        
charts:
  - name: customer_3d_analysis
    traces:
      - ${ref(customer_scatter_3d)}
    layout:
      title: "Customer Segmentation Analysis"
      scene:
        xaxis:
          title: "Age"
        yaxis:
          title: "Income ($)"
        zaxis:
          title: "Satisfaction Score"
        camera:
          eye:
            x: 1.5
            y: 1.5
            z: 1.5
```

## 3D Surface Plot

Create smooth surfaces from grid data:

```yaml
models:
  - name: surface_data
    source_name: analysis_db
    sql: |
      WITH grid AS (
        SELECT 
          x.val as x,
          y.val as y,
          SIN(SQRT(x.val*x.val + y.val*y.val)) / SQRT(x.val*x.val + y.val*y.val + 0.1) as z
        FROM 
          (SELECT -5 + 0.5 * s as val FROM generate_series(0, 20) s) x,
          (SELECT -5 + 0.5 * s as val FROM generate_series(0, 20) s) y
      )
      SELECT x, y, z FROM grid

traces:
  - name: mathematical_surface
    model: ${ref(surface_data)}
    props:
      type: surface
      x: ?{array_agg(DISTINCT x ORDER BY x)}
      y: ?{array_agg(DISTINCT y ORDER BY y)}
      z: ?{array_2d(z ORDER BY y, x)}  # 2D array for surface
      colorscale: "Viridis"
      contours:
        z:
          show: true
          usecolormap: true
          highlightcolor: "white"
          project:
            z: true
            
charts:
  - name: wave_surface
    traces:
      - ${ref(mathematical_surface)}
    layout:
      title: "3D Wave Function"
      scene:
        xaxis:
          title: "X"
        yaxis:
          title: "Y"
        zaxis:
          title: "Z"
```

## 3D Bar Chart

Visualize categorical data in three dimensions:

```yaml
models:
  - name: regional_sales_3d
    source_name: analysis_db
    sql: |
      WITH sales AS (
        SELECT 
          region,
          product,
          quarter,
          sales_amount
        FROM (
          VALUES 
            ('North', 'Product A', 'Q1', 45000),
            ('North', 'Product A', 'Q2', 52000),
            ('North', 'Product A', 'Q3', 48000),
            ('North', 'Product A', 'Q4', 55000),
            ('North', 'Product B', 'Q1', 38000),
            ('North', 'Product B', 'Q2', 42000),
            ('North', 'Product B', 'Q3', 40000),
            ('North', 'Product B', 'Q4', 46000),
            ('South', 'Product A', 'Q1', 41000),
            ('South', 'Product A', 'Q2', 43000),
            ('South', 'Product A', 'Q3', 47000),
            ('South', 'Product A', 'Q4', 51000),
            ('South', 'Product B', 'Q1', 35000),
            ('South', 'Product B', 'Q2', 37000),
            ('South', 'Product B', 'Q3', 39000),
            ('South', 'Product B', 'Q4', 41000)
        ) AS t(region, product, quarter, sales_amount)
      )
      SELECT * FROM sales

traces:
  - name: sales_bars_3d
    model: ${ref(regional_sales_3d)}
    props:
      type: scatter3d
      x: ?{quarter}
      y: ?{product}
      z: ?{sales_amount}
      mode: "markers"
      marker:
        size: 20
        color: ?{sales_amount}
        colorscale: "Blues"
        symbol: "square"
        line:
          color: "black"
          width: 1
      text: ?{region || ': $' || sales_amount}
      hoverinfo: "text"
```

## 3D Mesh Plot

Create complex 3D shapes and volumes:

```yaml
models:
  - name: mesh_vertices
    source_name: analysis_db
    sql: |
      -- Create a simple pyramid
      WITH vertices AS (
        SELECT * FROM (VALUES
          (0, 0, 0, 1),    -- Base corners
          (1, 0, 0, 2),
          (1, 1, 0, 3),
          (0, 1, 0, 4),
          (0.5, 0.5, 1, 5) -- Apex
        ) AS t(x, y, z, idx)
      )
      SELECT x, y, z, idx FROM vertices

traces:
  - name: pyramid_mesh
    model: ${ref(mesh_vertices)}
    props:
      type: mesh3d
      x: ?{array_agg(x ORDER BY idx)}
      y: ?{array_agg(y ORDER BY idx)}
      z: ?{array_agg(z ORDER BY idx)}
      i: [0, 0, 0, 0, 1, 2, 3]  # Vertex indices for faces
      j: [1, 2, 3, 4, 2, 3, 4]
      k: [4, 4, 4, 4, 3, 4, 1]
      color: "lightblue"
      opacity: 0.8
      
charts:
  - name: pyramid_viz
    traces:
      - ${ref(pyramid_mesh)}
    layout:
      title: "3D Pyramid Mesh"
      scene:
        aspectmode: "cube"
```

## 3D Line Plot

Show trajectories or paths in 3D space:

```yaml
models:
  - name: flight_path
    source_name: analysis_db
    sql: |
      WITH trajectory AS (
        SELECT 
          t as time,
          COS(t * 0.5) * 100 as x,
          SIN(t * 0.5) * 100 as y,
          t * 10 as altitude
        FROM (SELECT 0.1 * s as t FROM generate_series(0, 100) s)
      )
      SELECT time, x, y, altitude FROM trajectory

traces:
  - name: flight_trajectory
    model: ${ref(flight_path)}
    props:
      type: scatter3d
      x: ?{x}
      y: ?{y}
      z: ?{altitude}
      mode: "lines+markers"
      line:
        color: ?{altitude}
        colorscale: "Jet"
        width: 6
      marker:
        size: 3
        color: ?{altitude}
        colorscale: "Jet"
      text: ?{'Time: ' || ROUND(time, 1) || 's'}
```

## Isosurface Plot

Visualize 3D scalar fields:

```yaml
models:
  - name: density_field
    source_name: analysis_db
    sql: |
      WITH field AS (
        SELECT 
          x.val as x,
          y.val as y,
          z.val as z,
          EXP(-(x.val*x.val + y.val*y.val + z.val*z.val)) as value
        FROM 
          (SELECT -2 + 0.2 * s as val FROM generate_series(0, 20) s) x,
          (SELECT -2 + 0.2 * s as val FROM generate_series(0, 20) s) y,
          (SELECT -2 + 0.2 * s as val FROM generate_series(0, 20) s) z
      )
      SELECT * FROM field

traces:
  - name: density_iso
    model: ${ref(density_field)}
    props:
      type: isosurface
      x: ?{array_agg(x)}
      y: ?{array_agg(y)}
      z: ?{array_agg(z)}
      value: ?{array_agg(value)}
      isomin: 0.1
      isomax: 0.9
      surface:
        count: 5  # Number of isosurfaces
      colorscale: "RdBu"
      caps:
        x:
          show: false
        y:
          show: false
        z:
          show: false
```

## 3D Bubble Chart

Size represents a fourth dimension:

```yaml
models:
  - name: market_analysis_3d
    source_name: analysis_db
    sql: |
      WITH markets AS (
        SELECT 
          market_name,
          growth_rate,
          market_size,
          profit_margin,
          competition_level,
          market_size / 1000 as bubble_size
        FROM (VALUES
          ('Tech Hardware', 15.2, 45000, 22.5, 8),
          ('Software', 23.5, 82000, 35.2, 7),
          ('Healthcare', 18.7, 67000, 28.3, 6),
          ('Finance', 12.3, 53000, 31.5, 9),
          ('Retail', 8.5, 38000, 15.2, 10),
          ('Energy', 5.2, 71000, 18.7, 5)
        ) AS t(market_name, growth_rate, market_size, profit_margin, competition_level)
      )
      SELECT * FROM markets

traces:
  - name: market_bubbles
    model: ${ref(market_analysis_3d)}
    props:
      type: scatter3d
      x: ?{growth_rate}
      y: ?{profit_margin}
      z: ?{competition_level}
      mode: "markers+text"
      marker:
        size: ?{bubble_size}
        sizemode: "diameter"
        sizeref: 2
        color: ?{market_size}
        colorscale: "Viridis"
        colorbar:
          title: "Market Size ($M)"
        line:
          color: "white"
          width: 1
      text: ?{market_name}
      textposition: "top center"
```

## Best Practices

### Camera Positioning
```yaml
layout:
  scene:
    camera:
      eye:
        x: 1.25  # Distance multipliers
        y: 1.25
        z: 1.25
      center:
        x: 0
        y: 0
        z: 0
      up:
        x: 0
        y: 0
        z: 1  # Z-axis pointing up
```

### Aspect Ratio Control
```yaml
layout:
  scene:
    aspectmode: "cube"  # Equal scaling
    # Or manual:
    aspectratio:
      x: 1
      y: 1
      z: 0.5  # Compress Z-axis
```

### Performance Optimization
- **Data Reduction**: Sample large datasets before plotting
- **Surface Resolution**: Balance detail with performance
- **Marker Complexity**: Limit marker count for smooth interaction

### Visual Clarity
```yaml
# Add reference planes
traces:
  - name: xy_plane
    props:
      type: surface
      z: [[0, 0], [0, 0]]  # Flat plane at z=0
      showscale: false
      opacity: 0.2
      colorscale: [[0, "gray"], [1, "gray"]]
```

## Common Use Cases

### Scientific Visualization
```yaml
models:
  - name: molecular_structure
    sql: |
      SELECT 
        atom_type,
        x_coord,
        y_coord,
        z_coord,
        CASE atom_type
          WHEN 'C' THEN 12
          WHEN 'H' THEN 6
          WHEN 'O' THEN 10
        END as size
      FROM molecule_data
```

### Geographic Elevation
```yaml
models:
  - name: terrain_elevation
    sql: |
      SELECT 
        longitude,
        latitude,
        elevation,
        terrain_type
      FROM topographic_data
      WHERE region = 'Mountain Range'
```

### Time-Space Analysis
```yaml
models:
  - name: event_spacetime
    sql: |
      SELECT 
        event_time,
        location_x,
        location_y,
        magnitude
      FROM seismic_events
      ORDER BY event_time
```

## Related Resources
- [Scatter Plots](scatter.md) - 2D relationships
- [Surface Plots](../reference/configuration/trace/props/surface.md) - Detailed surface options
- [Geographic Maps](maps.md) - 2D geographic visualization
- [3D Concepts](../concepts/3d-visualization.md) - Understanding 3D data

---
*Next Steps:* Explore [Geographic Maps](maps.md) for location-based data visualization