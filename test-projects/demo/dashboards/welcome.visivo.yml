models:
  - name: Waterfall Model
    sql: |
      SELECT * FROM (
        SELECT 
          'y*3+1' as cohort_string,
          CASE WHEN x%2=1 THEN y*3+1 ELSE -y END as y, 
          x as week_day 
        FROM test_table 
        UNION ALL 
        SELECT 
          'y*2+2' as cohort_string,
          CASE WHEN x%2=1 THEN y*2+2 ELSE -y END as y, 
          x as week_day 
        FROM test_table WHERE x between 0 and 6) a
        ORDER BY week_day asc , cohort_string

traces:
  - name: Fibonacci Waterfall Trace
    model: ref(Waterfall Model)
    cohort_on: query(cohort_string)
    columns:
      x_data: week_day
      y_data: y
    props:
      type: waterfall
      measure: query('relative')
      x: column(x_data)[:3]
      y: column(y_data)[:3]
      text: query(cast(y as {% if env_var('IS_MYSQL') == 'NOT-SET' %}text{% else %}char{% endif %}))
      increasing:
        marker:
          color: "#b97a9b"
      decreasing:
        marker:
          color: "#edbdb5"
    order_by:
      - query(week_day asc)

dashboards:
  - name: Welcome to Visivo
    rows:
      - height: small
        items:
          - markdown: |
              # Welcome to Visivo 

              #### This is a demo dashboard that contains some simple examples of common use cases.

      - height: medium
        items:
          - markdown: |
              ## You can display your data in a table!
          - width: 2
            table:
              name: Fibonacci Waterfall Table
              trace: ref(Fibonacci Waterfall Trace)
              columns:
                - header: Widget Type
                  column: x_data
                - header: Widget Sales
                  column: y_data
