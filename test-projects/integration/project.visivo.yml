name: project

includes:
  - path: models.visivo.yml
  - path: traces.visivo.yml
  - path: insights.visivo.yml
  - path: visivo-io/example-include.git@main

defaults:
  source_name: local-duckdb
  alert_name: slack

inputs:
  # ===== SINGLE-SELECT INPUTS (all display types) =====

  # Single-select: Dropdown (default display)
  - name: split_threshold
    label: "Split Threshold (Dropdown)"
    type: single-select
    options: ["3", "5", "7"]
    display:
      type: dropdown
      default:
        value: "5"

  # Single-select: Query-based dropdown
  - name: min_x_value
    label: "Min X Value (Query Dropdown)"
    type: single-select
    options: ?{select distinct x FROM ${ref(local_test_table)} }
    display:
      type: dropdown

  # Single-select: Radio buttons
  - name: min_avg_y
    label: "Min Average Y (Radio)"
    type: single-select
    options: ["0", "5", "10"]
    display:
      type: radio
      default:
        value: "5"

  # Single-select: Tabs
  - name: sort_direction
    label: "Sort Direction (Tabs)"
    type: single-select
    options: ["ASC", "DESC"]
    display:
      type: tabs
      default:
        value: "ASC"

  # Single-select: Toggle (exactly 2 options required)
  - name: show_markers
    label: "Show Markers (Toggle)"
    type: single-select
    options: ["lines", "markers+lines"]
    display:
      type: toggle
      default:
        value: "markers+lines"

  # ===== MULTI-SELECT INPUTS (all display types) =====

  # Multi-select: Dropdown
  - name: selected_categories
    label: "Categories (Dropdown)"
    type: multi-select
    options: ["Category A", "Category B", "Category C", "Category D"]
    display:
      type: dropdown
      default:
        values: ["Category A", "Category B"]

  # Multi-select: Checkboxes
  - name: selected_groups
    label: "Groups (Checkboxes)"
    type: multi-select
    options: ["Group 1", "Group 2", "Group 3"]
    display:
      type: checkboxes
      default:
        values: all

  # Multi-select: Chips
  - name: selected_tags
    label: "Tags (Chips)"
    type: multi-select
    options: ["High", "Medium", "Low", "Critical"]
    display:
      type: chips
      default:
        values: ["High", "Medium"]

  # Multi-select: Range slider (for numeric values)
  - name: x_value_range
    label: "X Value Range (Slider)"
    type: multi-select
    options: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"]
    display:
      type: range-slider
      default:
        values: ["3", "4", "5", "6", "7"]

  # Multi-select: Query-based checkboxes
  - name: selected_x_values
    label: "X Values (Query Checkboxes)"
    type: multi-select
    options: ?{select distinct cast(x as varchar) FROM ${ref(local_test_table)} }
    display:
      type: checkboxes
      default: 
        values: all


  # ===== DATE-BASED INPUTS (new display types) =====

  # Single-select: Autocomplete (for large option sets)
  - name: autocomplete_date
    label: "Select Date (Autocomplete)"
    type: single-select
    options: ?{SELECT DISTINCT strftime(date, '%Y-%m-%d') as formatted_date FROM ${ref(daily_metrics)} ORDER BY formatted_date}
    display:
      type: autocomplete
      default:
        value: "2024-01-15"

  # Single-select: Slider (for numeric/date ranges)
  - name: slider_day_num
    label: "Day Number (Slider)"
    type: single-select
    options: ["1", "5", "10", "15", "20", "25", "30"]
    display:
      type: slider
      default:
        value: "15"

  # Multi-select: Date Range with date expressions
  - name: date_range_filter
    label: "Date Range (Calendar)"
    type: multi-select
    range:
      start: "today - 30 days"
      end: "today"
      step: "1 day"
    display:
      type: date-range
      default:
        start: "today - 7 days"
        end: "today"

  # Multi-select: Date Range with static dates for testing
  - name: static_date_range
    label: "January Date Range"
    type: multi-select
    range:
      start: "2024-01-01"
      end: "2025-01-31"
      step: "1 day"
    display:
      type: date-range
      default:
        start: "2024-01-01"
        end: "2024-01-05"

  # Single-select: Autocomplete with week-based dates
  - name: week_selector
    label: "Select Week Start (Autocomplete)"
    type: single-select
    options: ["2024-01-01", "2024-01-08", "2024-01-15", "2024-01-22", "2024-01-29"]
    display:
      type: autocomplete
      default:
        value: "2024-01-01"

alerts:
  - name: slack
    destinations:
      - type: slack
        webhook_url: https://hooks.slack.com/services/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

sources:
  - name: local-sqlite
    database: local.db
    type: sqlite

  - name: local-duckdb
    database: test.duckdb
    type: duckdb

  - name: local-postgres
    database: postgres
    type: postgresql
    host: localhost
    username: postgres
    password: "${ env.PG_PASSWORD }"
    port: 5434

    connection_pool_size: 1
  - name: local-mysql
    database: visivo
    type: mysql
    host: localhost
    username: root
    password: "${env.MYSQL_PASSWORD}"
    port: 3306

  - name: local-clickhouse
    type: clickhouse
    host: localhost
    port: 18123
    protocol: http
    database: visivo
    username: default
    password: clickhouse

  - name: remote-snowflake
    type: snowflake
    database: JARED_DEV
    account: bu13083.us-east-2.aws
    db_schema: DEFAULT
    username: "${env.CLI_UNIT_TESTING_SNOWFLAKE_USER}"
    warehouse: DEV
    password: "${env.CLI_UNIT_TESTING_SNOWFLAKE_PASSWORD}"
    role: PROD

  - name: remote-bigquery
    type: bigquery
    database: test
    project: "${env.BIGQUERY_PROJECT}"
    credentials_base64: "${env.BIGQUERY_BASE64_CREDENTIALS}"

charts:
  - name: indicator_chart
    traces:
      - ${ref(indicator-trace)}
  - name: surface-chart
    traces:
      - ${ref(surface-trace)}
    layout:
      title:
        text: Plot
      autosize: false
      width: 500
      height: 500
  # New charts using insights
  - name: simple-scatter-chart
    insights:
      - ${ ref(simple-scatter-insight) }
    layout:
      title:
        text: "Simple Scatter with Insights"
  - name: composite-metric-chart
    insights:
      - ${ref(composite-scatter-insight)}
  - name: fibonacci-split-chart
    insights:
      - ${ ref(fibonacci-split-insight) }
    layout:
      title:
        text: "Fibonacci with Split Interaction"
  - name: aggregated-bar-chart
    insights:
      - ${ ref(aggregated-bar-insight) }
    layout:
      title:
        text: "Aggregated Bar Chart"

  # Input-driven test charts
  - name: split-input-test-chart
    insights:
      - ${ ref(split-input-test-insight) }
    layout:
      title:
        text: "Split Interaction Test (Input-Driven)"

  - name: filter-nonaggregate-input-test-chart
    insights:
      - ${ ref(filter-nonaggregate-input-test-insight) }
    layout:
      title:
        text: "Non-Aggregate Filter Test (Input-Driven)"

  - name: filter-aggregate-input-test-chart
    insights:
      - ${ ref(filter-aggregate-input-test-insight) }
    layout:
      title:
        text: "Aggregate Filter Test (Input-Driven)"

  - name: sort-input-test-chart
    insights:
      - ${ ref(sort-input-test-insight) }
    layout:
      title:
        text: "Sort Order Test (Input-Driven)"

  - name: combined-interactions-test-chart
    insights:
      - ${ ref(combined-interactions-test-insight) }
    layout:
      title:
        text: "Combined Interactions Test"

  # ===== INPUT DISPLAY SHOWCASE CHARTS =====

  # Toggle display chart
  - name: toggle-mode-chart
    insights:
      - ${ ref(toggle-mode-insight) }
    layout:
      title:
        text: "Toggle Input: Dynamic Mode"

  # Range slider chart
  - name: range-slider-chart
    insights:
      - ${ ref(range-slider-insight) }
    layout:
      title:
        text: "Range Slider: Filter by Min/Max"

  # Checkboxes chart
  - name: checkboxes-filter-chart
    insights:
      - ${ ref(checkboxes-filter-insight) }
    layout:
      title:
        text: "Checkboxes: Multi-Value Filter"

  # Chips chart
  - name: chips-split-chart
    insights:
      - ${ ref(chips-split-insight) }
    layout:
      title:
        text: "Chips: Dynamic Split Labels"

  # ===== DATE-BASED CHARTS (new display types) =====

  # Autocomplete chart
  - name: autocomplete-date-chart
    insights:
      - ${ ref(autocomplete-date-insight) }
    layout:
      title:
        text: "Autocomplete: Date Filter"

  # Slider chart
  - name: slider-day-chart
    insights:
      - ${ ref(slider-day-insight) }
    layout:
      title:
        text: "Slider: Day Number Filter"

  # Date range chart
  - name: date-range-filter-chart
    insights:
      - ${ ref(date-range-filter-insight) }
    layout:
      title:
        text: "Date Range: Time Series Filter"

  # Date range category chart
  - name: date-range-category-chart
    insights:
      - ${ ref(date-range-category-insight) }
    layout:
      title:
        text: "Date Range: Category Aggregation"

  # Week selector chart
  - name: week-selector-chart
    insights:
      - ${ ref(week-selector-insight) }
    layout:
      title:
        text: "Week Selector: Autocomplete Filter"

dashboards:
  - name: insights-dashboard
    level: 0
    tags:
      - "insights"
      - "interactive"
    rows:
      # ===== SECTION 1: Original insights (no inputs) =====
      - height: compact
        items:
          - markdown:
              content: |
                ## Basic Insights (No Input Controls)
      - height: medium
        items:
          - width: 6
            chart: ${ ref(simple-scatter-chart) }
          - width: 6
            chart: ${ ref(fibonacci-split-chart) }
      - height: medium
        items:
          - width: 6
            chart: ${ ref(aggregated-bar-chart) }
          - width: 6
            chart: ${ref(composite-metric-chart)}

      # ===== SECTION 2: Input-Controlled Charts =====
      # Each input is directly above its related chart
      - height: compact
        items:
          - markdown:
              content: |
                ## Input-Controlled Charts
                Each input controls the chart directly below it

      # Split Threshold -> Split Input Test Chart
      - height: compact
        items:
          - width: 6
            input: ${ref(split_threshold)}
          - width: 6
            input: ${ref(min_x_value)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(split-input-test-chart) }
          - width: 6
            chart: ${ ref(filter-nonaggregate-input-test-chart) }

      # Min Avg Y (Radio) -> Aggregate Filter | Sort Direction -> Sort Chart
      - height: compact
        items:
          - width: 6
            input: ${ref(min_avg_y)}
          - width: 6
            input: ${ref(sort_direction)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(filter-aggregate-input-test-chart) }
          - width: 6
            chart: ${ ref(sort-input-test-chart) }

      # Combined inputs control combined chart
      - height: compact
        items:
          - width: 4
            input: ${ref(split_threshold)}
          - width: 4
            input: ${ref(min_x_value)}
          - width: 4
            input: ${ref(sort_direction)}
      - height: medium
        items:
          - width: 12
            chart: ${ ref(combined-interactions-test-chart) }

      # ===== SECTION 3: Display Type Showcase =====
      - height: compact
        items:
          - markdown:
              content: |
                ## Single-Select Display Types
                Toggle, Radio, Tabs, Dropdown - each input above its chart

      # Toggle -> Toggle Mode Chart
      - height: compact
        items:
          - width: 6
            input: ${ref(show_markers)}
          - width: 6
            input: ${ref(x_value_range)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(toggle-mode-chart) }
          - width: 6
            chart: ${ ref(range-slider-chart) }

      # Multi-select displays
      - height: compact
        items:
          - markdown:
              content: |
                ## Multi-Select Display Types
                Checkboxes, Chips, Range Slider

      # Checkboxes & Chips
      - height: compact
        items:
          - width: 6
            input: ${ref(selected_x_values)}
          - width: 6
            input: ${ref(selected_tags)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(checkboxes-filter-chart) }
          - width: 6
            chart: ${ ref(chips-split-chart) }

      # ===== SECTION 4: DATE-BASED INPUTS (New Display Types) =====
      - height: compact
        items:
          - markdown:
              content: |
                ## Date-Based Inputs (New Display Types)
                Autocomplete, Slider, and Date Range inputs

      # Autocomplete -> Autocomplete Date Chart
      - height: compact
        items:
          - width: 6
            input: ${ref(autocomplete_date)}
          - width: 6
            input: ${ref(slider_day_num)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(autocomplete-date-chart) }
          - width: 6
            chart: ${ ref(slider-day-chart) }

      # Date Range -> Date Range Charts
      - height: compact
        items:
          - width: 6
            input: ${ref(static_date_range)}
          - width: 6
            input: ${ref(week_selector)}
      - height: medium
        items:
          - width: 6
            chart: ${ ref(date-range-filter-chart) }
          - width: 6
            chart: ${ ref(week-selector-chart) }

      # Date Range Category Chart (uses same static_date_range input)
      - height: compact
        items:
          - width: 12
            input: ${ref(static_date_range)}
      - height: medium
        items:
          - width: 12
            chart: ${ ref(date-range-category-chart) }

      # Additional inputs (unused showcase)
      - height: compact
        items:
          - markdown:
              content: |
                ## Additional Multi-Select Inputs (Showcase)
          - input: ${ref(selected_categories)}
          - input: ${ref(selected_groups)}

  - name: table-dashboard
    level: 1
    tags:
      - "tables"
    rows:
      - height: compact
        items:
          - markdown:
              content: |
                # Text!
              align: left
              justify: between
      - height: small
        items:
          - align: left
            markdown:
              content: |2

                Lorem ipsum odor amet, consectetuer adipiscing elit.  
                ```
                Volutpat primis laoreet, ridiculus in placerat facilisis laoreet. 
                ```
                > Montes semper quam litora condimentum maximus. 
                * Sollicitudin montes rhoncus sollicitudin mus et elit. 
                * Erat erat lectus turpis consequat sed tortor suspendisse rhoncus maximus. 
                #### <span title="This is a normal name and there's nothing funny about it.">Bigus Dicus </span>
                Nostra ornare urna nullam scelerisque quis. Natoque nullam aliquet taciti blandit facilisi vel sollicitudin montes. Nulla platea diam, vitae velit varius fringilla. Dolor condimentum convallis proin augue a fusce suspendisse. Eget elit tempor sociosqu platea feugiat.

                Nostra ornare urna nullam scelerisque quis. Natoque nullam aliquet taciti blandit facilisi vel sollicitudin montes. Nulla platea diam, vitae velit varius fringilla. Dolor condimentum convallis proin augue a fusce suspendisse. Eget elit tempor sociosqu platea feugiat.

                Nostra ornare urna nullam scelerisque quis. Natoque nullam aliquet taciti blandit facilisi vel sollicitudin montes. Nulla platea diam, vitae velit varius fringilla. Dolor condimentum convallis proin augue a fusce suspendisse. Eget elit tempor sociosqu platea feugiat.

                Nostra ornare urna nullam scelerisque quis. Natoque nullam aliquet taciti blandit facilisi vel sollicitudin montes. Nulla platea diam, vitae velit varius fringilla. Dolor condimentum convallis proin augue a fusce suspendisse. Eget elit tempor sociosqu platea feugiat.

      - height: medium
        items:
          - width: 1
            markdown:
              content: |
                ## Sub heading
                1. Numbered
                1. Lists are cool

                But we can have lots of other _content_ as well
          - width: 3
            table:
              name: awesome-table
              column_defs:
                - trace_name: fibonacci-waterfall
                  columns:
                    - key: "columns.x_data"
                    - key: "columns.y_data"
                      header: "y amount"
                      aggregation: "sum"
                    - key: "columns.measure"
                    - key: "props.text"
              traces:
                - ${ref(fibonacci-waterfall)}
              rows_per_page: 1000
          - width: 2
            chart: ${ ref(indicator_chart) }
      - height: medium
        items:
          - table:
              name: awesome-table-2
              column_defs:
                - trace_name: markdown-trace-base-with-a-super-super-long-name-markdown-trace-base-even-longer-now-with-more-characters
                  columns:
                    - key: "columns.vanilla_text"
                    - key: "columns.markdown"
                      header: "Markdown"
                      markdown: true
              traces:
                - model: ${ ref(markdown-table-base) }
                  name: markdown-trace-base-with-a-super-super-long-name-markdown-trace-base-even-longer-now-with-more-characters
                  columns:
                    vanilla_text: vanilla_text
                    markdown: markdown

  - name: simple-dashboard
    level: 0
    tags:
      - "charts"
      - "simple"
    rows:
      - height: medium
        items:
          - width: 9
            chart:
              name: a-very-fibonacci-waterfall
              traces:
                - ${ref(fibonacci-waterfall)}
                - ${ref(example-indicator)}
              layout:
                title:
                  text: "AAPL P&L"
                waterfallgroupgap: 0.1
          - width: 2
            chart:
              name: aggregated-fib
              traces:
                - ${ref(aggregated-line)}
              layout:
                title:
                  text: "Aggregated Fibonacci"
                yaxis:
                  title:
                    text: "output"
                xaxis:
                  title:
                    text: "More if x>3 Less if x<=3"
      - height: medium
        items:
          - width: 3
            chart:
              name: fibonacci-plane
              traces:
                - ${ref(3d-line-one)}
                - ${ref(3d-line-two)}
              layout:
                title:
                  text: "The Greatest 3d Lines"
                legend:
                  orientation: "h"
                  yanchor: "bottom"
                  y: 1.02
                  xanchor: "right"
                  x: 1
          - width: 4
            chart:
              name: fibonacci
              traces:
                - ${ref(simple-line)}
              layout:
                title:
                  text: "A great fibonacci series"
                yaxis:
                  title:
                    text: "Output"
                xaxis:
                  title:
                    text: "Input"

          - width: 3
            chart:
              name: fibonacci-times-2
              traces:
                - name: double-simple-line
                  #cohort_on: "?{'Fibonacci times 2'}"
                  model:
                    name: nested-and-name
                    sql: "SELECT x, y*3 as y FROM test_table"
                  props:
                    type: scatter
                    x: ?{x}
                    y: ?{y}
                    line:
                      shape: spline
                      color: "#4F494C"
                  order_by:
                    - ?{x asc}
                  tests:
                    - assertions:
                        - ">{ ${ref(double-simple-line).props.x[2]} == 3 }"
                - ${ref(simple-line)}
              layout:
                title:
                  text: "A not great fibonacci series"
                yaxis:
                  title:
                    text: "Output"
                xaxis:
                  title:
                    text: "Input"
      - height: medium
        items:
          - width: 2
            markdown:
              content: |
                # Here is the first
                1. Numbered 
                1. List
          - width: 2
            chart:
              name: funnel-chart
              traces:
                - ${ref(funnel-trace)}
              layout:
                title:
                  text: "Funnel Chart"
      - height: xlarge
        items:
          - chart: ${ ref(surface-chart) }
