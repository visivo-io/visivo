relations:
  - name: local_to_local
    condition: ${ref(local_test_table).x} = ${ref(another_local_test_table).x}

metrics: 
  - name: composite_metric
    expression: ${ref(local_test_table).x_sum} + ${ref(another_local_test_table).new_y_sum}

models:
  - name: local_test_table
    sql: "SELECT * FROM test_table"
    metrics:
      - name: x_sum
        expression: "SUM(x)"
    dimensions:
      - name: x_rounded
        expression: "ROUND(x, 2)"
  - name: another_local_test_table
    sql: "SELECT x*y+y as new_x, y*x as new_y, x FROM test_table"
    metrics:
      - name: new_y_sum
        expression: "SUM(new_y)"
    dimensions:
      - name: new_x_rounded
        expression: "ROUND(new_x, 2)"
  - name: second_local_test_table
    sql: "SELECT * FROM second_test_table"
  - name: join_table
    sql: |
      SELECT ltt.x, sltt.y FROM local_test_table.model AS ltt 
        JOIN second_local_test_table.model AS sltt
        ON ltt.x = sltt.x
    models:
      - ${ ref(local_test_table) }
      - ${ ref(second_local_test_table) }
  - name: csv
    table_name: csv
    args:
      - echo
      - |
        x,y
        1,9
        2,1
        3,2
        4,3
        5,5
        6,8

  - name: markdown-table-base
    args: 
      - echo
      - | 
        vanilla_text,markdown
        plain,plain
        **bold**,**bold**
        <ins>[link](https://visivo.io/)</ins>,<ins>[link](https://visivo.io/)</ins>
        # header,# header

  - name: processes
    table_name: processes
    args:
      - python
      - create_processes_csv.py
      - "&&"
      - cat target/processes.csv

  - name: waterfall_model
    table_name: appl_pl
    args:
      - cat
      - data/aapl_pl.csv

  # Date-based model for testing date inputs and expressions
  - name: daily_metrics
    source: ${ref(local-duckdb)}
    sql: |
      SELECT
        date_trunc('day', TIMESTAMP '2024-01-01' + INTERVAL (x) DAY) AS date,
        x as day_num,
        y as value,
        CASE 
          WHEN x % 4 = 0 THEN 'Category A'
          WHEN x % 3 = 0 THEN 'Category B'
          WHEN x % 2 = 0 THEN 'Category C'
          ELSE 'Category D' 
        END as category
      FROM test_table
      WHERE x <= 30
    dimensions:
      - name: formatted_date
        expression: "strftime(date, '%Y-%m-%d')"
    metrics:
      - name: total_value
        expression: "SUM(value)"
      - name: avg_value
        expression: "AVG(value)"
